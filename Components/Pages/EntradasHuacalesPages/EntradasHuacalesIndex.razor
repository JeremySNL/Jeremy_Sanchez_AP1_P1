@page "/EntradasHuacales/Index";

@inject NavigationManager navigationManager;
@inject EntradasHuacalesService entradasHuacalesService;

<PageTitle>IndexEntradasHuacales</PageTitle>
<div class="container">
    <div class="card shadow-lg">
        <div class="card-header justify-content-between d-flex align-center">
            <h3>Registro de entradas de huacales</h3>
            <a class="btn btn-primary" href="/EntradasHuacales/Create"><span class="bi bi-plus-square"></span> Crear</a>
        </div>
        <div class="card-body">
            <QuickGrid class="table table-striped" Items="@ListaEntradasHuacales.AsQueryable()" ItemKey="@(e => e.IdEntrada)">
                <PropertyColumn Property="@(e => e.IdEntrada)" Sortable="true" Title="Id"></PropertyColumn>
                <PropertyColumn Property="@(e => e.Fecha)" Format="dd-MM-yyyy hh:mm tt" Sortable="true" Title="Fecha" IsDefaultSortColumn="true" InitialSortDirection="Microsoft.AspNetCore.Components.QuickGrid.SortDirection.Descending"></PropertyColumn>
                <PropertyColumn Property="@(e => e.NombreCliente)" Sortable="true" Title="Nombre del cliente"></PropertyColumn>
                <PropertyColumn Property="@(e => e.Cantidad)" Sortable="true" Title="Cantidad"></PropertyColumn>
                <PropertyColumn Property="@(e => e.Precio)" Sortable="true" Title="Precio"></PropertyColumn>
                <TemplateColumn Class="text-center" Title="Acciones">
                    <a href="/EntradasHuacales/Edit/@context.IdEntrada" class="btn btn-outline-primary bi bi-pencil-square"></a>
                </TemplateColumn>
            </QuickGrid>
            </div>
        <div class="card-footer justify-content-between d-flex">
            <label>Cantidad: @ListaEntradasHuacales.Count</label>
            <label class="text-success fw-bold">Total: @Total</label>
        </div>
    </div>
</div>

@code {
    public List<EntradasHuacales> ListaEntradasHuacales { get; set; } = new List<EntradasHuacales>();
    public String Filtro { get; set; } = String.Empty;
    public String ValorFiltro { get; set; } = String.Empty;
    public decimal Total { get; set; } = 0;

    protected override async Task OnInitializedAsync()
    {
        ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.IdEntrada > 0);
        await CalcularTotal();
    }

    public async Task Filtrar()
    {
        if (ValorFiltro == "")
        {
            ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.IdEntrada > 0);
            await CalcularTotal();
            return;
        }
        if (Filtro != "")
        {
            if (Filtro == "NombreCliente")
            {
                ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.NombreCliente.Trim().Contains(ValorFiltro));
            }
            if (Filtro == "Cantidad")
            {
                ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.Cantidad == Int32.Parse(ValorFiltro));
            }
            if (Filtro == "Precio")
            {
                ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.Precio == Decimal.Parse(ValorFiltro));
            }
        }
        else
        {
            ListaEntradasHuacales = await entradasHuacalesService.Listar(e => e.IdEntrada > 0);
        }
        await CalcularTotal();
    }

    public async Task CalcularTotal()
    {
        Total = 0;
        foreach (EntradasHuacales entradaHuacal in ListaEntradasHuacales)
        {
            Total += entradaHuacal.Cantidad * entradaHuacal.Precio;
        }
    }
}
